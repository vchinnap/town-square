name: Label Nugget Discussions

on:
  discussion:
    types: [created, edited]

jobs:
  label_nugget:
    runs-on: ubuntu-latest
    steps:
    - name: Check for existing labels and add 'Nugget' label
      uses: actions/github-script@v6
      with:
        script: |
          const discussion = context.payload.discussion;
          const nuggetLabel = 'Nugget';  // You can change to 'Knowledge Nugget' if needed

          // Log the current discussion labels for debugging
          console.log(`Current labels: ${discussion.labels.map(label => label.name).join(', ')}`);

          const labels = discussion.labels.map(label => label.name);
          
          // Add 'Nugget' label if it's not already present
          if (!labels.includes(nuggetLabel)) {
            console.log(`Label '${nuggetLabel}' not found, adding now.`);
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: discussion.number,
              labels: [nuggetLabel],
            });
            console.log(`Label '${nuggetLabel}' added successfully.`);
          } else {
            console.log(`Label '${nuggetLabel}' already exists on this discussion.`);
          }
        github-token: ${{ secrets.G_TOKEN }}  # Replace with your GitHub token secret
